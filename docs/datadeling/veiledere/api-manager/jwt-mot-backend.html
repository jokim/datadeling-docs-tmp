<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Backend-autentisering med JWTs | Datadeling Test</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/jwt-mot-backend"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Backend-autentisering med JWTs | Datadeling Test"><meta data-rh="true" name="description" content="Hvordan du kan skjule JWT-autentisering i Gravitee, for eksempel for Maskinporten, uten at hver API-eier trenger f√• tilgang til n√∏kkelen."><meta data-rh="true" property="og:description" content="Hvordan du kan skjule JWT-autentisering i Gravitee, for eksempel for Maskinporten, uten at hver API-eier trenger f√• tilgang til n√∏kkelen."><link data-rh="true" rel="icon" href="/datadeling-docs-tmp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/jwt-mot-backend"><link data-rh="true" rel="alternate" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/jwt-mot-backend" hreflang="en"><link data-rh="true" rel="alternate" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/jwt-mot-backend" hreflang="x-default"><link rel="stylesheet" href="/datadeling-docs-tmp/assets/css/styles.d37e78f4.css">
<link rel="preload" href="/datadeling-docs-tmp/assets/js/runtime~main.f6e3b48d.js" as="script">
<link rel="preload" href="/datadeling-docs-tmp/assets/js/main.bee006d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/datadeling-docs-tmp/"><div class="navbar__logo"><img src="/datadeling-docs-tmp/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/datadeling-docs-tmp/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Datadeling</b></a><a class="navbar__item navbar__link navbar__link--active" href="/datadeling-docs-tmp/docs/intro">Dokumentasjon</a></div><div class="navbar__items navbar__items--right"><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/datadeling-docs-tmp/docs/intro">Test av dokumentasjonen til prosjekt Datadeling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/datadeling-docs-tmp/docs/datadeling">datadeling</a><button aria-label="Toggle the collapsible sidebar category &#x27;datadeling&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/begreper">begreper</a><button aria-label="Toggle the collapsible sidebar category &#x27;begreper&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/erfaringer">erfaringer</a><button aria-label="Toggle the collapsible sidebar category &#x27;erfaringer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/faq">Sp√∏rsm√•l og svar</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/god-praksis">god-praksis</a><button aria-label="Toggle the collapsible sidebar category &#x27;god-praksis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/kode">Kode som bruker IntArk</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/kurs">kurs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/malgrupper/anskaffer">malgrupper</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/om">om</a><button aria-label="Toggle the collapsible sidebar category &#x27;om&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/prinsippene">Integrasjonsprinsippene for IntArk</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/styringsregler">Styringsreglene til IntArk</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform">teknisk-plattform</a><button aria-label="Toggle the collapsible sidebar category &#x27;teknisk-plattform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/unntak">Unntaksh√•ndtering i IntArk</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere">veiledere</a><button aria-label="Toggle the collapsible sidebar category &#x27;veiledere&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/annet/anskaffelse">annet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/api-manager-be-om-tilgang">api-manager</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/api-manager-be-om-tilgang">F√• tilgang til et API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/api-manager-registrere-enkelt-api">Registrere et enkelt API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/api-tilganger">Forvaltning av tilganger til API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/backend">Konfigurere backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/caching-gravitee">Caching i gravitee</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/filtrere-innhold-json">Filtrere bort innhold i responsen fra et API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/godkjenne-tilgang-til-api">Godkjenne tilgang til API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/importer-api">Importer API-oppsett fra fil</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/jwt-mot-backend">Backend-autentisering med JWTs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/legge-pa-enkel-policy">Legge p√• en enkel policy (IP filter)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/maskinporten-autentisering">Konfigurere autentisering via maskinporten </a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/opprette-plan">Opprette plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/rettigheter-og-roller-i-api-manager">Rettigheter, roller og grupper i API Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/rolle-internrevisjon">Egne roller i Gravitee (f.eks. for innsyn)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/se-bruk-av-api">Se bruken av ditt API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/varsling-for-api-eiere">Varsling av nye subscriptions o.l.</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/innforing">Kom i gang med IntArk</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/meldingsk√∏/opprett-tjeneste">meldingsk√∏</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere/sjekkliste-innforing">Sjekkliste for innf√∏ring av IntArk</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/">üè†</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/docs/datadeling">datadeling</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/docs/datadeling/veiledere">veiledere</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">api-manager</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/jwt-mot-backend">Backend-autentisering med JWTs</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Backend-autentisering med JWTs</h1><p>Hvordan du kan skjule JWT-autentisering i Gravitee, for eksempel for Maskinporten, uten at hver API-eier trenger f√• tilgang til n√∏kkelen.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="bakgrunn">Bakgrunn<a class="hash-link" href="#bakgrunn" title="Direct link to heading">‚Äã</a></h2><p>Flere API-er hos andre institusjoner, bl.a. DF√ò, krever autentisering med maskinporten. Andre API kan kreve autentisering med andre Authorization servers. Som oftest er det best om applikasjonen f√•r tilgang og autentiserer direkte mot Authorization serveren, men noen ganger kan det v√¶re hensiktsmessig √• autentisere API gateway mot API gateway.</p><p>DF√ò har satt opp API-ene sine i maskinporten slik at man er n√∏dt til √• bruke virksomhetssertifikatet til autentisering. Med mange integrasjoner og andre applikasjoner som skal ha tilgang til disse API-ene blir dette sertifikatet lagret mange steder hvis hver applikasjon skal autentisere selv. For √• begrense antall steder sertifikatet ligger blir denne autentiseringen heller utf√∏rt i Gravitee.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="lage-jwt-i-gravitee">Lage JWT i Gravitee<a class="hash-link" href="#lage-jwt-i-gravitee" title="Direct link to heading">‚Äã</a></h3><p>Velg API-et du vil legge til autentisering for. G√• til design i venstre sidemeny, og deretter videre til Policies. Bruk policyen &quot;Generate JWT&quot; for √• lage en JWT. Denne kan brukes videre, f.eks. i policyen &quot;Add header&quot; eller &quot;HTTP Callout&quot;.</p><p>Generate JWT:</p><p><a target="_blank" href="/datadeling-docs-tmp/assets/files/image-20200928103116-1-02705284548bf65f9a86dce0e4a779f4.png"><img loading="lazy" alt="Generate JWT policyen" src="/datadeling-docs-tmp/assets/images/image-20200928103116-1-02705284548bf65f9a86dce0e4a779f4.png" width="2227" height="1262"></a></p><p>Det er mange felt som m√• fylles inn, og hvilke som brukes avhenger av hvilken autorisasjons servere som brukes.</p><p> Disse er verdt √• merke seg:</p><ul><li>Om sertifikatet er lagret p√• filsystemet (ta kontakt med IntArk-drift for dette), velg &quot;The content of the private key is provided by reading a PKCS12/JKS/PEM file from file system&quot; under &quot;Key resolver&quot;. Path til riktig mappe skrives inn i &quot;Private key / Secret key / key store path&quot;. Hvis ikke, velg &quot;The content of the private key/secret is provided inline&quot; og lim denne inn i &quot;Private key / Secret key / key store path&quot; lenger ned</li><li>Passordet til den private n√∏kkelen blir vist i klartekst. V√¶r n√∏ye og begrens hvem som har tilgang til API-et</li><li>Om du har lastet opp sertifikatet til Authorization serveren skriv inn ID-en p√• n√∏kkelen i feltet &quot;kid&quot;. Hvis det er virksomhetssertifikat, ikke fyll inn feltet &quot;kid&quot;, men velg heller &quot;Add a certificate chain as axn X5C attribute&quot; i feltet &quot;Certificate chain&quot;</li><li>Du kan legge p√• s√• mange ekstra Claims som du vil</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="bruke-jwt-til-autentisering-og-motta-bearer-token">Bruke JWT til autentisering og motta bearer-token<a class="hash-link" href="#bruke-jwt-til-autentisering-og-motta-bearer-token" title="Direct link to heading">‚Äã</a></h3><p>Dette gj√∏res med HTTP Callout. Legg inn URL til autentiserings-endepunktet du skal bruke og evt. headere/parametere. Legg ved JWT-en som akkurat ble laget ved √• bruke Expression Language-notasjon: ${context.attributes<!-- -->[&#x27;jwt.generated&#x27;]<!-- -->}.</p><p>F.eks. for √• bruke mot maskinporten m√• du legge ved f√∏lgende data: grant<!-- -->_<!-- -->type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&amp;assertion=${context.attributes<!-- -->[&#x27;jwt.generated&#x27;]<!-- -->}.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="legge-ved-token">Legge ved token<a class="hash-link" href="#legge-ved-token" title="Direct link to heading">‚Äã</a></h3><p>For √• legge p√• bearer-token mottatt med HTTP Callaout-policyer: i &quot;Transform Headers&quot;-policy, klikk p√• plusstegnet under add, fyll inn Authorization som &quot;Name&quot; og som &quot;value&quot;: Bearer {#context.attributes<!-- -->[&#x27;token&#x27;]<!-- -->}.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="eksempel-maskinporten-som-api">Eksempel: Maskinporten som API<a class="hash-link" href="#eksempel-maskinporten-som-api" title="Direct link to heading">‚Äã</a></h3><p>I Gravitee har vi registrert maskinporten (p.t. versjon 2 test-l√∏sningen) som et API.</p><ul><li>API-et er ikke publisert</li><li>Det er sikret med API n√∏kkel og sperret til IP</li><li>Backend server endpoint er for test: <a href="https://ver2.maskinporten.no/token" target="_blank" rel="noopener noreferrer">https://ver2.maskinporten.no/token</a></li></ul><p>Det er satt opp med f√∏lgende policyer:</p><ul><li>IP Filtering: NRECs ip-adresser er hvitelistet</li><li>Cache: Bruker parameteren scope som key, application som scope, og 3599 (sekunder) som maks varighet p√• cachede objekter. Policyen henter svar fra cache kun n√•r http-metoden er GET.</li><li>Generate JWT: Denne genererer JWT-filen som vi bruker for √• autentisere mot maskinporten. iss (issuer) og scope hentes som parametere, resten av feltene er hardkodet</li><li>Assign content: Legger p√• requesten ihht. oauth2-standard og med JWT som akkurat er generert som assertion</li><li>Transform parameters: Fjerner parameterne iss og scope</li><li>Transform headers: Legger til encoding</li><li>Override HTTP method: Endrer til POST</li></ul><p>API-et er ogs√• satt opp med en cache-ressurs.</p><p>Applikasjonene er i tillegg registrert i samarbeidsportalen. Forel√∏pig er det registrert √©n applikasjon med fire scope. Applikasjons-ID-en herfra er den som blir brukt som paramteren <em>iss</em> (for Issuer). Denne er ogs√• registrert hos DF√ò.</p><p>Virksomhetssertifikatet er opprettet som en secret i openshift-prosjektet og mountet som katalogen /certs p√• b√•de API-manager og Gateway-podene. P√• denne m√•ten trenger vi kun registrere path til filen i API-et. Det er ikke n√∏dvendig, men man kan og lime inn base64-encoded virksomhetssertifikat rett inn i policyen.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="bruk">Bruk<a class="hash-link" href="#bruk" title="Direct link to heading">‚Äã</a></h3><p>API-ene som bruker dette for autentisering har to ekstra policyer:</p><ul><li>HTTP Callout: Denne gj√∏r en callout til maskinporten-API-et som er registrert hos oss med http metode GET og parameter for riktig scope, riktig issuer og headeren X-Gravitee-Api-Key for √• f√• tilgang</li><li>Transform headers: Legger p√• headeren Authorization med verdien &#x27;Bearer&#x27; og JWT-tokenet som maskinporten returnerer</li></ul><p>I tillegg er de registrert som applikasjoner i API manager. Disse har og f√•tt tilgang til maskinporten-API-et og API-n√∏kkelen er registrert i HTTP callout-policyen.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="bruksanvisning">Bruksanvisning<a class="hash-link" href="#bruksanvisning" title="Direct link to heading">‚Äã</a></h3><ul><li>For √• registrere et API med maskinporten-autentisering m√• det registreres som en applikasjon, og s√∏ke om tilgang til maskinporten-API-et. N√•r tilgang er godkjent brukes API-n√∏kkelen i http callout-policyen</li><li>P√• siden for √• administrere API-et, velg Design i venstre sidemeny og dra policyen &quot;HTTP Callout&quot; til midten. Fyll inn:<ul><li>scope: request</li><li>HTTP Method: GET (Kan ogs√• v√¶re POST. Da blir det generert nytt token hver gang. Det skaper un√∏dvendig belastning p√• maskinporten og er tregt, men gj√∏r feils√∏king enklere)</li><li>URL: <a href="https://gw-XXX.intark.uh-it.no/maskinporten-test/v2?iss=**%5C%3CISSUER%3E**&amp;scope=**%5C%3CSCOPE%3E**" target="_blank" rel="noopener noreferrer">https://gw-XXX.intark.uh-it.no/maskinporten-test/v2?iss=<strong>\&lt;ISSUER<!-- -->&gt;</strong>&amp;scope=<strong>\&lt;SCOPE<!-- -->&gt;</strong></a> (issuer finner du i samarbeidsportalen)</li><li>Legg til Header X-Gravitee-Api-Key. Verdien er API-n√∏kkelen fra forrige punkt</li><li>Legg til Context variabel med navn = Token og value = {#jsonPath(#calloutResponse.content, &#x27;$.access<!-- -->_<!-- -->token&#x27;)}</li></ul></li><li>Dra s√• policyen Transform Header inn i midten. Under Add/update headers, legg til en med navn Authorization og verdi Bearer {#context.attributes<!-- -->[&#x27;token&#x27;]<!-- -->}</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/jokim/datadelingsdokumentasjon/tree/master/docs/datadeling/veiledere/api-manager/jwt-mot-backend.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/importer-api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Importer API-oppsett fra fil</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/legge-pa-enkel-policy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Legge p√• en enkel policy (IP filter)</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#bakgrunn" class="table-of-contents__link toc-highlight">Bakgrunn</a><ul><li><a href="#lage-jwt-i-gravitee" class="table-of-contents__link toc-highlight">Lage JWT i Gravitee</a></li><li><a href="#bruke-jwt-til-autentisering-og-motta-bearer-token" class="table-of-contents__link toc-highlight">Bruke JWT til autentisering og motta bearer-token</a></li><li><a href="#legge-ved-token" class="table-of-contents__link toc-highlight">Legge ved token</a></li><li><a href="#eksempel-maskinporten-som-api" class="table-of-contents__link toc-highlight">Eksempel: Maskinporten som API</a></li><li><a href="#bruk" class="table-of-contents__link toc-highlight">Bruk</a></li><li><a href="#bruksanvisning" class="table-of-contents__link toc-highlight">Bruksanvisning</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 HK-dir, Unit, Uninett AS</div></div></div></footer></div>
<script src="/datadeling-docs-tmp/assets/js/runtime~main.f6e3b48d.js"></script>
<script src="/datadeling-docs-tmp/assets/js/main.bee006d5.js"></script>
</body>
</html>