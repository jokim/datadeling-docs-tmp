<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">RabbitMQ | Datadeling Test</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="RabbitMQ | Datadeling Test"><meta data-rh="true" name="description" content="RabbitMQ tar seg av dine meldingskøer og din tjenestes meldinger. Så du"><meta data-rh="true" property="og:description" content="RabbitMQ tar seg av dine meldingskøer og din tjenestes meldinger. Så du"><meta data-rh="true" property="og:image" content="https://jokim.github.io//datadeling-docs-tmp/prosjekter/datadeling/arbeidsomrader/integrasjonsarkitektur/dokumentasjon/img/rabbitmq-logo.png"><meta data-rh="true" name="twitter:image" content="https://jokim.github.io//datadeling-docs-tmp/prosjekter/datadeling/arbeidsomrader/integrasjonsarkitektur/dokumentasjon/img/rabbitmq-logo.png"><link data-rh="true" rel="icon" href="/datadeling-docs-tmp/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq"><link data-rh="true" rel="alternate" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq" hreflang="en"><link data-rh="true" rel="alternate" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq" hreflang="x-default"><link rel="stylesheet" href="/datadeling-docs-tmp/assets/css/styles.d37e78f4.css">
<link rel="preload" href="/datadeling-docs-tmp/assets/js/runtime~main.07f16fb2.js" as="script">
<link rel="preload" href="/datadeling-docs-tmp/assets/js/main.32c6fdb5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/datadeling-docs-tmp/"><div class="navbar__logo"><img src="/datadeling-docs-tmp/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/datadeling-docs-tmp/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Datadeling</b></a><a class="navbar__item navbar__link navbar__link--active" href="/datadeling-docs-tmp/docs/intro">Dokumentasjon</a></div><div class="navbar__items navbar__items--right"><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/datadeling-docs-tmp/docs/intro">Test av dokumentasjonen til prosjekt Datadeling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/datadeling-docs-tmp/docs/datadeling">datadeling</a><button aria-label="Toggle the collapsible sidebar category &#x27;datadeling&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/begreper">begreper</a><button aria-label="Toggle the collapsible sidebar category &#x27;begreper&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/erfaringer">erfaringer</a><button aria-label="Toggle the collapsible sidebar category &#x27;erfaringer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/faq">Spørsmål og svar</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/god-praksis">god-praksis</a><button aria-label="Toggle the collapsible sidebar category &#x27;god-praksis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/kode">Kode som bruker IntArk</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/malgrupper/anskaffer">malgrupper</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/om">om</a><button aria-label="Toggle the collapsible sidebar category &#x27;om&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/prinsippene">Integrasjonsprinsippene for IntArk</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/styringsregler">Styringsreglene til IntArk</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform">teknisk-plattform</a><button aria-label="Toggle the collapsible sidebar category &#x27;teknisk-plattform&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/oversikt">Oversikt over den tekniske plattformen</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/api/dfo-sap">api</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjening for RabbitMQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/gravitee">Gravitee</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/infrastruktur">Infrastrukturen til IntArks tekniske plattform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/prosessene">Prosessene for teknisk plattform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq">RabbitMQ</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/unntak">Unntakshåndtering</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/veiledere">veiledere</a><button aria-label="Toggle the collapsible sidebar category &#x27;veiledere&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/">🏠</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/docs/datadeling">datadeling</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform">teknisk-plattform</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq">RabbitMQ</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>RabbitMQ</h1></header><p>RabbitMQ tar seg av dine meldingskøer og din tjenestes meldinger. Så du
slipper.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="kom-i-gang">Kom i gang<a class="hash-link" href="#kom-i-gang" title="Direct link to heading">​</a></h2><p>For de utålmodige:</p><ol><li>Bruk <a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjeningsportalen for
RabbitMQ</a> for å sette opp
meldingshåndteringen for din tjeneste. </li><li>Hent ut tilkoblingsdetaljer for din tjeneste fra selvbetjeningsportalen.
Bruk dette i din tjeneste for å både publisere og motta meldinger.</li></ol><p>Anbefalt meldingsprotokoll: <a href="http://www.amqp.org/specification/0-9-1/amqp-org-download" target="_blank" rel="noopener noreferrer">AMQP 0.9.1</a> på port 5671 (TLS).</p><p>Se <a href="/datadeling-docs-tmp/docs/datadeling/kode">kode-eksempler</a>:</p><ul><li>Hvordan sende notifikasjoner (datatilbyder):  <a target="_blank" href="/datadeling-docs-tmp/assets/files/publisering_simpel-ddafea0fb4b995e8f9e7789734651964.py">publisering_simpel.py</a></li><li>Hvordan motta notifikasjoner (konsument): <a target="_blank" href="/datadeling-docs-tmp/assets/files/konsument_simpel-33ff4a78aeb8375333523069ffb741bb.py">konsument_simpel.py</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="hva-er-rabbitmq">Hva er RabbitMQ?<a class="hash-link" href="#hva-er-rabbitmq" title="Direct link to heading">​</a></h2><p>RabbitMQ er en tjeneste for å håndtere meldinger og meldingskøer. Systemet ble
valgt i IntArk fordi det følger <a href="/datadeling-docs-tmp/docs/datadeling/prinsippene">IntArk sine
integrasjonsprinsipper</a>, spesielt med god støtte for åpne
standarder i stedet for sine egne, proprietære løsninger.</p><p>De fleste trenger ikke tilgang til RabbitMQ direkte, men bruker det via
<a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjeningsportalen for RabbitMQ</a>.
RabbitMQ krever en del teknisk innsikt for å brukes riktig.</p><p>Datatilbydere kan sende inn meldinger fra sin tjeneste til RabbitMQ. RabbitMQ
tar seg av å fordele disse meldingene videre til alle konsumenter som abonnerer
på meldingene. Datatilbyder trenger da ikke å måtte forholde seg til hvor mange
konsumenter det er, eller for eksempel å måtte sende ut meldinger på nytt fordi
en konsument har mistet sin melding. Alt dette håndteres av RabbitMQ.</p><p><img loading="lazy" alt="Melding fra datatilbyder til konsumenter" src="/datadeling-docs-tmp/assets/images/rmq-exchange-f5708b96583fc14b68322f3272eba9cd.png" width="649" height="160"></p><p>Vi bruker protokollen AMQP for notifikasjoner, men RabbitMQ støtter også andre
protokoller for meldingsutveksling.</p><p>RabbitMQ er primært satt opp for å støtte integrasjonsmønsteret
<a href="/datadeling-docs-tmp/docs/datadeling/god-praksis/integrasjonsmonster/hendelsesbasert">hendelsesbasert provisjonering</a>,
med <a href="/datadeling-docs-tmp/docs/datadeling/god-praksis/notifikasjonsdesign">notifikasjoner (tynne meldinger)</a>,
men kan også brukes for andre typer meldinger og integrasjoner.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="hvordan-bruker-jeg-rabbitmq">Hvordan bruker jeg RabbitMQ?<a class="hash-link" href="#hvordan-bruker-jeg-rabbitmq" title="Direct link to heading">​</a></h2><p>Vi anbefaler å bruke <a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjeningsportalen for
RabbitMQ</a> heller enn å bruke RabbitMQ
direkte. RabbitMQ krever god teknisk innsikt, så vi har utviklet et eget
grensesnitt i IntArk for å gjøre forvaltningen av meldinger mye enklere.</p><p>RabbitMQ har et eget grensesnitt, som primært brukes av teknikere og driftere.
Se <a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/oversikt">oversikt over teknisk
plattform</a> for URL. Hver tjeneste
får påloggingsdetaljer til RabbitMQ, som er tilgjengelig i
selvbetjeningsportalen. I RabbitMQ kan du blant annet se aktiviteten for dine
køer, sende og hente ut meldinger, og gjøre mer avanserte endringer på
oppsettet av meldingskøer og exchanges.</p><p>RabbitMQ gir deg et kraftig verktøy, med mange muligheter og innstillinger.
Dette øker også sjansen for å sette opp meldingshåndteringen ulikt for
tjenester. Selvbetjeningsportalen sikrer at oppsettet blir mer standardisert
mellom tjenestene.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="tekniske-detaljer">Tekniske detaljer<a class="hash-link" href="#tekniske-detaljer" title="Direct link to heading">​</a></h2><p>Litt mer tekniske detaljer om hva vi bruker i RabbitMQ. Selvbetjeningsportalen
håndterer mye av dette for deg, så du ikke skal kunne ha dyp innsikt i dette.</p><p>Kort om noen begreper: En tjeneste publiserer sine meldinger i en <em>exchange</em>,
som du kan se på som et postmottak. RabbitMQ ser på hvem som skal ha hvilke av
meldinger fra exchangen, og kopierer disse over til riktige meldingskøer.
Tjenester som abonnerer på meldinger henter disse fra en meldingskø. Når en
tjeneste henter ut en melding, må den &quot;ack&quot;-es for å slettes fra meldingskøen.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="amqp">AMQP<a class="hash-link" href="#amqp" title="Direct link to heading">​</a></h3><p>I IntArk bruker vi primært meldingsprotokollen <a href="http://www.amqp.org/specification/0-9-1/amqp-org-download" target="_blank" rel="noopener noreferrer">AMQP
0.9.1</a>. Se <a href="http://www.rabbitmq.com/tutorials/amqp-concepts.html" target="_blank" rel="noopener noreferrer">RabbitMQ
sin beskrivelse av
begrepene</a> for mer
utdypende informasjon.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="vhosts">Vhosts<a class="hash-link" href="#vhosts" title="Direct link to heading">​</a></h3><p>En <em>virtuell host,</em> eller <em>vhost</em>, er RabbitMQ sin måte å skille prosjekt eller
tjenester fra hverandre. Alle entiteter - kø, binding og exchange - vil ligge i
<em>én</em> <em>vhost</em>.</p><p>I IntArk setter vi opp hver tjeneste i sin egen <em>vhost</em>, for å isolere dem fra
andre tjenester. Når noen blir gitt tilgang til meldinger fra en tjeneste, blir
disse kopiert mellom vhosts. Selvbetjeningsportalen tar seg av dette.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="brukere">Brukere<a class="hash-link" href="#brukere" title="Direct link to heading">​</a></h3><p>For å skrive inn til en exchange og lese fra meldingskøen, trenger du en
<em>bruker</em> med de rette tilgangene. Hver bruker har tilgang til sin vhost.</p><p>Du kan hente ut påloggingsdetaljer for din tjeneste fra selvbetjeningsportalen,
så du kan logge på i RabbitMQ og se hva du har tilgang til.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="exchange">Exchange<a class="hash-link" href="#exchange" title="Direct link to heading">​</a></h3><p>En <em>exchange</em> er et &quot;postkontor&quot; som en avsender sender notifikasjoner til.
Notifikasjonene distribueres (routes) videre derfra, til de forskjellige
<em>køene</em> som vil ha den relevante notifikasjonen.</p><p>I IntArk har vi en exchange per tjeneste. Meldinger distribueres videre med
metoden <strong>Topic Exchange</strong>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="kø">Kø<a class="hash-link" href="#kø" title="Direct link to heading">​</a></h3><p>En kø (<em>queue</em>) er én konsuments samling av meldinger, eller hvilke typer
notifikasjonar den vil ha (se <em>Binding</em>).  <em>RabbitMQ</em> videredistribuerer
(router) de notifikasjonene køen vil ha. Konsumenten abonnerer da på denne
køen.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="binding">Binding<a class="hash-link" href="#binding" title="Direct link to heading">​</a></h3><p>Hver kø settes opp med hvilke typer notifikasjoner den vil ha - køen må være
bundet (bound) til en <em>exchange</em> med en eller flere nøkler. For <em>topic
exchange</em>, går knytningen mot <em>topic</em>.</p><p>Selvbetjeningsportalen setter opp bindings når søknader om tilganger blir
akseptert.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="topic">Topic<a class="hash-link" href="#topic" title="Direct link to heading">​</a></h3><p>Når <em>topic exchange</em> brukes for å distribuere (route) notifikasjoner fra
<em>exchange</em> til riktig kø, må avsender markere hver notifikasjon med en <em>message
routing key (topic)</em>. RabbitMQ vil se på <em>topic</em> og videresende (<em>route</em>)
notifikasjonen til de køene som har binding mot samme <em>topic.</em></p><p>Strukturen til <em>message routing key (topic)</em>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kilde.type.objekt.hendelse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>der:</p><ul><li><code>kilde</code>: Navnet til avsenderen, for eksempel &quot;cerebrum&quot;</li><li><code>type</code>: Typen melding, for eksempel &quot;event&quot;</li><li><code>objekt</code>: Vanligvis hva entitetstype notifikasjonen/hendelsen gjelder for, for eksempel &quot;account&quot;, &quot;person&quot;, &quot;group&quot; eller &quot;employee&quot;</li><li><code>hendelse</code>: Hva har skjedd, for eksempel &quot;add&quot;, &quot;delete&quot; eller &quot;modify&quot;</li></ul><p>Datatilbyder skal vanligvis dokumentere hvilke verdier de bruker. Dette gjør
det enklere for konsumenter å ignorere meldinger som ikke er relevante for de.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="om-rabbitmq">Om RabbitMQ<a class="hash-link" href="#om-rabbitmq" title="Direct link to heading">​</a></h3><p>IntArk bruker <a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">RabbitMQ</a> for å håndtere
meldingskøer. </p><p>Hver applikasjon opprettet i selvbetjeningsportalen blir registrert som en
bruker i RabbitMQ, som du også kan logge på med. Brukernavn og passord finner
du i selvbetjeningsportalen. Ta kontakt hvis din institusjon trenger egne
brukere med andre rettigheter.</p><p>RabbitMQ kjører som et cluster med 3 noder. Du må ta høyde for at en av nodene
kan være nede. Det anbefales å bruke køer av typen <em>Quorum</em> i produksjon. </p><p>RabbitMQ har ingen direkte kobling med Gravitee, annet enn at de kjører på den
samme infrastrukturen, og brukes av de samme datatilbydere og konsumenter.
Dette er to helt uavhengige produkter, og blir blant annet oppgradert uavhengig
av hverandre.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="notifikasjoner">Notifikasjoner<a class="hash-link" href="#notifikasjoner" title="Direct link to heading">​</a></h2><p>TODO: Flytt alt dette til &quot;god-praksis&quot;.</p><p>I IntArk bruker vi RabbitMQ primært for det vi kaller <strong>tynne meldinger</strong>,
eller <strong>notifikasjoner</strong>. Notifikasjonene brukes primært til å informere om at
<em>noe</em> har skjedd med en bestemt entitet, men en konsument må selv spørre
kildesystemet om mer detaljer. Dette brukes i integrasjonsmønsteret
<a href="/datadeling-docs-tmp/docs/datadeling/god-praksis/integrasjonsmonster/hendelsesbasert">hendelsesbasert
provisjonering</a>.</p><p>Datatilbyder må dokumentere sine notifikasjoner i sin institusjons API-katalog.</p><p>For nyutviklede system, bør du vurdere å bruke standariserte format, for eksempel <a href="https://cloudevents.io/" target="_blank" rel="noopener noreferrer">CloudEvents</a>.</p><p>TODO: Legg inn dømer frå CloudEvents! Resten er mindre viktig.</p><p>For eksempel bruker Cerebrum og SAPUiO et notifikasjonsformat som er inspirert av <a href="http://www.simplecloud.info/" target="_blank" rel="noopener noreferrer">SCIM</a> sitt <a href="https://tools.ietf.org/html/draft-hunt-idevent-scim-00" target="_blank" rel="noopener noreferrer">utkast til standard på et meldingsformat</a>, der vi bruker versjonen med minimalt med informasjon. Et eksempel på hvordan ei melding vil se ut, <strong>omtrent</strong>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // token identifier (unik id for meldingen)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;jti&quot;: &quot;4d3559ec67504aaba65d40b0363faad8&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // endringer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;eventUris&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;urn:ietf:params:event:SCIM:create&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iat&quot;: 1458496404,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iss&quot;: &quot;https://cerebrum-uio.uio.no&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // audience (spreads/kontekst) - gjør det enklere å forkaste meldinger du ikke er interessert i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aud&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;AD\_account&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;exchange\_acc@uio.no&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;LDAP\_account&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // URL til entitet (GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> **&quot;sub&quot;: &quot;https://cerebrum-ws.uio.no/v1/accounts/1234&quot;,**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Parametre til event - her: hvilke attributter hos objektet som er påviret - gjør det enklere å forkaste meldinger du ikke er interessert i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;urn:ietf:params:event:SCIM:create&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;attributes&quot;:[&quot;id&quot;,&quot;name&quot;,&quot;userName&quot;,&quot;password&quot;,&quot;emails&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Andre system, som FS og TP, bruker et format som er avledet fra <a href="https://jwt.io" target="_blank" rel="noopener noreferrer">JWT</a>-standarden. Et eksempel på en notifikasjon fra FS om at en person er oppdatert (routing key er i dette tilfelle <em>no.uio.fs.FS-prod.personer.update</em>)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;sub&quot;: &quot;personer/56154&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;iss&quot;: &quot;FS-prod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;iat&quot;: &quot;1582344412462&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;operation&quot;: &quot;update&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;jti&quot;: &quot;35380ac0-247d-44b3-9be3-2f2dded049ee&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;person\_id&quot;: &quot;56154&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Det kan og være lurt å ta en avgjørelse om hvordan du skal referere til ressurser i kildesystem. For eksempel er vi bundet til et spesielt domene i dette tilfellet:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;sub&quot;: &quot;https://api-waygate.uio.no/eksempeltjeneste/5&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Mens følgende ikke er bundet til en spesifikk maskin:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;sub&quot;: &quot;/5&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;iss&quot;: &quot;eksempeltjeneste&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Det samme kan du oppnå med en mer formalisert URN:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;sub&quot;: &quot;urn:eksempeltjeneste:5&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>I de to siste eksemplene har vi ikke inkludert informasjon om <em>hvor</em> en ressurs er lokalisert. Når du henter ressursen må du da velge å slå opp maskinnavnet. Erfaringsmessig letter dette arbeidet med å flytte tjenester mellom forskjellige miljø.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="se-også">Se også<a class="hash-link" href="#se-også" title="Direct link to heading">​</a></h2><ul><li><a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjeningsportalen for RabbitMQ</a> - vi anbefaler at du bruker denne, og ikke RabbitMQ direkte.</li><li><a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">RabbitMQ sine egne nettsider</a></li><li><a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener noreferrer">RabbitMQ sine tutorials for publisering og konsumering av meldinger</a></li><li><a href="http://www.rabbitmq.com/tutorials/amqp-concepts.html" target="_blank" rel="noopener noreferrer">RabbitMQ sin beskrivelse av begrepene i AMQP</a></li><li><a href="http://www.amqp.org/specification/0-9-1/amqp-org-download" target="_blank" rel="noopener noreferrer">Beskrivelse av meldingsprotokollen AMQP 0.9.1</a></li><li><a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/mq-oppsett">Teknisk oppsett av meldingskøer</a></li><li><a href="/datadeling-docs-tmp/docs/datadeling/god-praksis/integrasjonsmonster/hendelsesbasert">Integrasjonsmønsteret hendelsebasert provisjonering</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/jokim/datadelingsdokumentasjon/tree/master/docs/datadeling/teknisk-plattform/rabbitmq.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/prosessene"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Prosessene for teknisk plattform</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/datadeling-docs-tmp/docs/datadeling/unntak"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Unntakshåndtering</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#kom-i-gang" class="table-of-contents__link toc-highlight">Kom i gang</a></li><li><a href="#hva-er-rabbitmq" class="table-of-contents__link toc-highlight">Hva er RabbitMQ?</a></li><li><a href="#hvordan-bruker-jeg-rabbitmq" class="table-of-contents__link toc-highlight">Hvordan bruker jeg RabbitMQ?</a></li><li><a href="#tekniske-detaljer" class="table-of-contents__link toc-highlight">Tekniske detaljer</a><ul><li><a href="#amqp" class="table-of-contents__link toc-highlight">AMQP</a></li><li><a href="#vhosts" class="table-of-contents__link toc-highlight">Vhosts</a></li><li><a href="#brukere" class="table-of-contents__link toc-highlight">Brukere</a></li><li><a href="#exchange" class="table-of-contents__link toc-highlight">Exchange</a></li><li><a href="#kø" class="table-of-contents__link toc-highlight">Kø</a></li><li><a href="#binding" class="table-of-contents__link toc-highlight">Binding</a></li><li><a href="#topic" class="table-of-contents__link toc-highlight">Topic</a></li><li><a href="#om-rabbitmq" class="table-of-contents__link toc-highlight">Om RabbitMQ</a></li></ul></li><li><a href="#notifikasjoner" class="table-of-contents__link toc-highlight">Notifikasjoner</a></li><li><a href="#se-også" class="table-of-contents__link toc-highlight">Se også</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 HK-dir, Unit, Uninett AS</div></div></div></footer></div>
<script src="/datadeling-docs-tmp/assets/js/runtime~main.07f16fb2.js"></script>
<script src="/datadeling-docs-tmp/assets/js/main.32c6fdb5.js"></script>
</body>
</html>