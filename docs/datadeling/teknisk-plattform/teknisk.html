<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Tekniske detaljer om IntArk-plattformen | Datadeling Test</title><meta data-react-helmet="true" property="og:url" content="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/teknisk"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Tekniske detaljer om IntArk-plattformen | Datadeling Test"><meta data-react-helmet="true" name="description" content="Vi bruker i dag [Gravitee](https://gravitee.io) API Management som API manager og [RabbitMQ](https://rabbitmq.com) for meldingskø. Begge kjører på en kubernetes-distribusjon [OKD](https://okd.io) som er installert i [NREC](https://nrec.no)."><meta data-react-helmet="true" property="og:description" content="Vi bruker i dag [Gravitee](https://gravitee.io) API Management som API manager og [RabbitMQ](https://rabbitmq.com) for meldingskø. Begge kjører på en kubernetes-distribusjon [OKD](https://okd.io) som er installert i [NREC](https://nrec.no)."><link data-react-helmet="true" rel="shortcut icon" href="/datadeling-docs-tmp/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/teknisk"><link data-react-helmet="true" rel="alternate" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/teknisk" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jokim.github.io//datadeling-docs-tmp/docs/datadeling/teknisk-plattform/teknisk" hreflang="x-default"><link rel="stylesheet" href="/datadeling-docs-tmp/assets/css/styles.b121cd8c.css">
<link rel="preload" href="/datadeling-docs-tmp/assets/js/runtime~main.6a0ac74d.js" as="script">
<link rel="preload" href="/datadeling-docs-tmp/assets/js/main.7b5df807.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/datadeling-docs-tmp/"><img src="/datadeling-docs-tmp/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/datadeling-docs-tmp/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Datadeling</b></a><a class="navbar__item navbar__link navbar__link--active" href="/datadeling-docs-tmp/docs/intro">Dokumentasjon</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/datadeling-docs-tmp/docs/intro">Test av dokumentasjonen til prosjekt Datadeling</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">datadeling</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">begreper</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">community</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/faq">Spørsmål og svar</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">forvaltning</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">god-praksis</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">hva-er</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/index(1)">UH:IntArk - Datadeling i universitets- og høgskolesektoren</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling">UH:IntArk - Datadeling i universitets- og høgskolesektoren</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">innforing</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">kode</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">kontaktpunkt</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">kurs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">malgrupper</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">om</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">prinsippene</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/sidestruktur">Sidestruktur</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/status">Status på arbeidet med nettsidene</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">teknisk-plattform</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/api-manager">API manager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/api-plan-applikasjon">Hvordan vi bruker Gravitee som API manager</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">api</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjening for RabbitMQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/gravitee">Gravitee</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform">UH:IntArk sin tekniske plattform</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/krav">Føringer for bruk av teknisk plattform i UH:IntArk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/mq-oppsett">Bruk av meldingskø</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/oversikt">Oversikt over den tekniske plattformen</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/prosessene">Prosessene for teknisk plattform</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq">RabbitMQ</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/teknisk">Tekniske detaljer om IntArk-plattformen</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">vedtak</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">veiledere</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Tekniske detaljer om IntArk-plattformen</h1></header><p>Vi bruker i dag <a href="https://gravitee.io" target="_blank" rel="noopener noreferrer">Gravitee</a> API Management som API manager og <a href="https://rabbitmq.com" target="_blank" rel="noopener noreferrer">RabbitMQ</a> for meldingskø. Begge kjører på en kubernetes-distribusjon <a href="https://okd.io" target="_blank" rel="noopener noreferrer">OKD</a> som er installert i <a href="https://nrec.no" target="_blank" rel="noopener noreferrer">NREC</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gravitee-api-management"></a>Gravitee API Management<a class="hash-link" href="#gravitee-api-management" title="Direct link to heading">#</a></h2><p>Vi bruker open source versjonen av <a href="https://gravitee.io" target="_blank" rel="noopener noreferrer">Gravitee API management.</a> Vi kjører kun komponenten som heter <em>API management</em>, ikke <em>Access Management</em> eller <em>Alert Engine</em>.</p><p>Per idag bruker vi versjon 1, og oppgraderer til siste underversjon omtrent en gang i måneden. Ved hjelp av <em>rolling upgrades</em> kan vi oppgradere helt uten nedetid for <em>API gateway</em>.</p><p>Alle containere som brukes av Gravitee kjører 2 eller 3 av for å få redundans.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rabbitmq"></a>RabbitMQ<a class="hash-link" href="#rabbitmq" title="Direct link to heading">#</a></h2><p>RabbitMQ kjører versjon 3.8.6, og vi benytter i hovedsak AMQPS-protokollen for å sende og motta meldinger. De fleste trenger ikke tilgang til RabbitMQ direkte, men bruker det via <a href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/brom">Selvbetjeningsportalen for RabbitMQ</a>.</p><p>For å likevel få tilgang til RabbitMQ sitt management-grensesnitt kan du kontakte <a href="mailto:integrasjon@uio.no" target="_blank" rel="noopener noreferrer">integrasjon@uio.no</a> for å få opprettet en bruker og tildelt nødvendige rettigheter.</p><p>RabbitMQ kjører som et cluster med 3 noder. Du må ta høyde for at en av nodene kan være nede, det anbefales å bruke HA-mode i produksjon.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="kobling-mellom-api-manager-og-meldingkø"></a>Kobling mellom API manager og meldingkø<a class="hash-link" href="#kobling-mellom-api-manager-og-meldingkø" title="Direct link to heading">#</a></h2><p>API manager og meldingskø har ingen direkte kobling seg imellom. De kan derfor byttes ut uavhengig av hverandre. De snakker derimot med de samme systemene.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="okd"></a>OKD<a class="hash-link" href="#okd" title="Direct link to heading">#</a></h2><p>OKD står for &quot;The Community Distribution of Kubernetes that powers <a href="https://www.openshift.com" target="_blank" rel="noopener noreferrer">Red Hat OpenShift&quot;,</a> og er upstream-versjonen av Openshift. Det blir i dagligtale ofte omtalt som Openshift.</p><p>IntArk-plattforman har egne clustre som kjører på NREC i osl-sonen. Per oktober 2020 brukes versjon 3.11 av OKD, men vi planlegger oppgradere til versjon 4.7 i løpet av sommeren 2021. De er installert med ovs-multitenant SDN plugin, og hvert prosjekt (namespace) er nettverksmessig isolert.</p><p>Hver institusjon som bruker IntArk-plattformen har hvert sitt prosjekt hvor Gravitee og RabbitMQ kjører.</p><p>Oppgraderinger av OKD er for versjon 3 basert på blue-green-metodikk. Det vil si at oppgraderinger skjer ved å installere nytt cluster med nyeste versjon av alle komponenter, og deretter flytte applikasjonene fra et cluster til et annet. Dette betyr at alle tjenester vil bytte IP-adresse ved oppgraderinger.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lastbalanserer"></a>Lastbalanserer<a class="hash-link" href="#lastbalanserer" title="Direct link to heading">#</a></h2><p>Det står en lastbalanserer i forkant som sender trafikk til riktig cluster. Denne har samme IP-adresse for alle, og bruker <a href="https://en.wikipedia.org/wiki/Server_Name_Indication" target="_blank" rel="noopener noreferrer">SNI (Server Name Indication)</a> for å route trafikken til riktig sted. I web-verdenen har dette vært standard lenge og man behøver ikke tenke på dette. Når man skal koble til en meldingskø må man derimot ofte spesifisere at man skal bruke SNI.</p><p><img alt="Tekniske komponenter i IntArk-plattformen" src="/datadeling-docs-tmp/assets/images/intark-komponenter-630785cbecd15233752216c5c4523dbd.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ip-ranges"></a>IP-ranges<a class="hash-link" href="#ip-ranges" title="Direct link to heading">#</a></h2><p>IntArk sin tekniske plattform kjører i regionen <em>osl</em> til NREC. Hvis du ønsker å lage brannmurregler som ikke trenger hyppige oppdateringer anbefaler vi å åpne for alle subnettene til NREC. Se <a href="https://iaas.readthedocs.io/team/installation/ip.html" target="_blank" rel="noopener noreferrer">NREC sin oversikt hvilke nettverk de bruker</a>.</p><p>Vi anbefaler <strong>ikke</strong> å sperre ned til spesifikke IP-adresser, fordi:</p><ol><li>IntArk-installasjonene bytter cluster ved oppgraderinger</li><li>Tjenester kan bytte IP-adresse</li><li>Cluster utvides fortløpende med nye servere</li></ol><p>Ulempen ved å åpne for alle subnettene til NREC, eller til et spesifikt cluster, er at de deles av andre institusjoner. Hvis du har API med strenge krav til brannmurregler anbefaler vi at du kjører dette via en http-proxy-server som krever brukernavn og passord.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/jokim/datadeling-docs-tmp/tree/gh-pages/docs/datadeling/teknisk-plattform/teknisk.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« RabbitMQ</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/datadeling-docs-tmp/docs/datadeling/vedtak"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Vedtak i UH:IntArk »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#gravitee-api-management" class="table-of-contents__link">Gravitee API Management</a></li><li><a href="#rabbitmq" class="table-of-contents__link">RabbitMQ</a></li><li><a href="#kobling-mellom-api-manager-og-meldingkø" class="table-of-contents__link">Kobling mellom API manager og meldingkø</a></li><li><a href="#okd" class="table-of-contents__link">OKD</a></li><li><a href="#lastbalanserer" class="table-of-contents__link">Lastbalanserer</a></li><li><a href="#ip-ranges" class="table-of-contents__link">IP-ranges</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 HK-dir, Unit, Uninett AS</div></div></div></footer></div>
<script src="/datadeling-docs-tmp/assets/js/runtime~main.6a0ac74d.js"></script>
<script src="/datadeling-docs-tmp/assets/js/main.7b5df807.js"></script>
</body>
</html>