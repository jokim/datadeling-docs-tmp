"use strict";(self.webpackChunkdatadeling=self.webpackChunkdatadeling||[]).push([[7555],{3905:function(e,t,n){n.d(t,{Zo:function(){return k},kt:function(){return u}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),p=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},k=function(e){var t=p(e.components);return r.createElement(o.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,k=l(e,["components","mdxType","originalType","parentName"]),d=p(n),u=a,m=d["".concat(o,".").concat(u)]||d[u]||g[u]||i;return n?r.createElement(m,s(s({ref:t},k),{},{components:n})):r.createElement(m,s({ref:t},k))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,s=new Array(i);s[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var p=2;p<i;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8838:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return p},toc:function(){return k},default:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),s=["components"],l={description:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]\n\n\nHvordan kan du sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon.",title:"Konfigurere autentisering via maskinporten "},o="Konfigurere autentisering via maskinporten",p={unversionedId:"datadeling/veiledere/api-manager/maskinporten-autentisering",id:"datadeling/veiledere/api-manager/maskinporten-autentisering",isDocsHomePage:!1,title:"Konfigurere autentisering via maskinporten ",description:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]\n\n\nHvordan kan du sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon.",source:"@site/docs/datadeling/veiledere/api-manager/maskinporten-autentisering.md",sourceDirName:"datadeling/veiledere/api-manager",slug:"/datadeling/veiledere/api-manager/maskinporten-autentisering",permalink:"/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/maskinporten-autentisering",editUrl:"https://github.com/jokim/datadeling-docs-tmp/tree/gh-pages/docs/datadeling/veiledere/api-manager/maskinporten-autentisering.md",version:"current",frontMatter:{description:"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]\n\n\nHvordan kan du sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon.",title:"Konfigurere autentisering via maskinporten "},sidebar:"tutorialSidebar",previous:{title:"Legge p\xe5 en enkel policy (IP filter)",permalink:"/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/legge-pa-enkel-policy"},next:{title:"Opprette plan",permalink:"/datadeling-docs-tmp/docs/datadeling/veiledere/api-manager/opprette-plan"}},k=[{value:"Bakgrunn",id:"bakgrunn",children:[]},{value:"Forutsetninger",id:"forutsetninger",children:[]},{value:"Registrer API i Maskinporten",id:"registrer-api-i-maskinporten",children:[]},{value:"Registrer APIet",id:"registrer-apiet",children:[]},{value:"Registrere applikasjon",id:"registrere-applikasjon",children:[]}],g={toc:k};function d(e){var t=e.components,l=(0,a.Z)(e,s);return(0,i.kt)("wrapper",(0,r.Z)({},g,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"konfigurere-autentisering-via-maskinporten"},"Konfigurere autentisering via maskinporten"),(0,i.kt)("p",null,"[Under utvikling: Anbefalingen vil endre seg, etter erfaringer med BOTT:\xd8L i 2021]"),(0,i.kt)("p",null,"Hvordan kan du sette opp autentisering av ditt API via Maskinporten, n\xe5r du trenger \xe5 snakke med API utenfor din organisasjon."),(0,i.kt)("h3",{id:"bakgrunn"},"Bakgrunn"),(0,i.kt)("p",null,"Maskinporten kan brukes til sikker autentisering mot API p\xe5 tvers av organisasjoner."),(0,i.kt)("p",null,"N\xe5r man bruker maskinporten autentiserer man seg f\xf8rst mot maskinporten med et sertifikat. Som svar f\xe5r man et aksess token, som igjen brukes til autorisasjon i API Gatewayen"),(0,i.kt)("h3",{id:"forutsetninger"},"Forutsetninger"),(0,i.kt)("p",null,"Det forutsettes at organisajsonen din er registrert som bruker av maskinporten og har f\xe5tt opprettet et prefix."),(0,i.kt)("h3",{id:"registrer-api-i-maskinporten"},"Registrer API i Maskinporten"),(0,i.kt)("p",null,"F\xf8rst m\xe5 APIet registreres i maskinporten. Da opprettes det et scope . Et scope kan brukes til \xe5 gi tilganger til ressurser i et eller flere API. Det anbefales \xe5 ikke bruke samme scope for \xe5 gi tilgang til ulike API."),(0,i.kt)("p",null,"I tillegg m\xe5 de organisasjonene som skal f\xe5 tilgang til APIet bli gitt tilgang. Dette kan gj\xf8res b\xe5de f\xf8r og etter at APIet er registrert i API Gateway"),(0,i.kt)("h3",{id:"registrer-apiet"},"Registrer APIet"),(0,i.kt)("p",null,"Om det ikke allerede er registrert. Om det ikke er gjort allerede er det ",(0,i.kt)("a",{parentName:"p",href:"/docs/datadeling/veiledere/api-manager/api-manager-registrere-enkelt-api"},"veiledning her.")," Kom tilbake til dette siden n\xe5r det skal opprettes planer"),(0,i.kt)("p",null,"Opprett plan med sikret med JWT"),(0,i.kt)("p",null,"Et aksess token er en type token som kalles Java Web Token, forkortet JWT ( uttales jot eller j\xe5t.)"),(0,i.kt)("p",null,"Opprett en ny plan ved \xe5 g\xe5 til APIet, velg Plans og trykk p\xe5 +-tegnet"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"webside for \xe5 opprette planer",src:n(7043).Z})),(0,i.kt)("p",null,"Skriv inn navn og en beskrivelse av planen. G\xe5 til neste side"),(0,i.kt)("p",null,"P\xe5 siden for secutiry vegl JWT som security type"),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(9049).Z})),(0,i.kt)("p",null,"I menyen for ",(0,i.kt)("strong",{parentName:"p"},"Signature")," la RS256 v\xe6re valgt (det er eneste som st\xf8ttes av maskinporten p.t.)"),(0,i.kt)("p",null,"I menyen ",(0,i.kt)("strong",{parentName:"p"},"JWKS Resolver"),", velg JWKS","_","URL"),(0,i.kt)("p",null,"I ",(0,i.kt)("strong",{parentName:"p"},"Resolver parameter")," skriv eller lim inn URL hvor API Gatewayen kan finne maskinportens offentiig sertifikat. I produksjon er dette ",(0,i.kt)("a",{parentName:"p",href:"https://maskinporten.no/jwk"},"https://maskinporten.no/jwk")," , i test er det ",(0,i.kt)("a",{parentName:"p",href:"https://ver2.maskinporten.no/jwk"},"https://ver2.maskinporten.no/jwk")," eller ",(0,i.kt)("a",{parentName:"p",href:"https://ver1.maskinporten.no/jwk"},"https://ver1.maskinporten.no/jwk")," , alt etter hvilket test-milj\xf8 man benytter"),(0,i.kt)("p",null,"Om du vil kunne bruke informasjon fra tokenet til flere sjekker og / eller i policy-er, huk av for ",(0,i.kt)("strong",{parentName:"p"},"Extract JWT Claims"),"."),(0,i.kt)("p",null,"Det er god praksis \xe5 sjekke autorisasjonen som er gitt b\xe5de i API-gateway og i selve APIet. Med mindre du ikke stoler p\xe5 APIet eller det er for testing, lar du ",(0,i.kt)("strong",{parentName:"p"},"Propagate Authorization Header")," v\xe6re huket av. Aksess-tokenet blir da sendt til backend-APIet, og samme eller mer grundig sjekk av tokenet foretas der. Det vil og forhindre urettmessig tilgang til APIet dersom man sp\xf8r backend-APIet direkte uten \xe5 g\xe5 via gateway-en"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"User claim")," fungerer ikke p.t. med maskinporten"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Additional selection rules.")," Her kan det bli litt komplisert. Har kan man legge inn flere regler for \xe5 v\xe6re sikker p\xe5 at riktig plan blir valgt. Om APIet kun skal brukes av et scope kan du legge inn en sjekk av scope her. Er man sikker p\xe5 at tokenet kun vil inneholde dette scopet, bruk f.eks."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\n#context.attributes['jwt'].claims['scope'] matches '^org:test$'\n")),(0,i.kt)("p",null,"om man vil tillate at tokenet har andre scope i tilegg til det som gir tilgang til ditt API kan man bruke"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\n#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$'\n")),(0,i.kt)("p",null,"Et litt mer avansert eksempel, man har et API hvor man kan bli tildelt enten lese og skriverettigheter, eller kun skirve eller kun lese-rettighet"),(0,i.kt)("p",null,"Da kan man ha en plan for \xe5de lese og skrive-tilgang med denne ekstra regelen"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\n#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$' && #context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test.write(\\\\s[a-z:\\\\s])?$'\n")),(0,i.kt)("p",null,"on for kun skirvetilgang:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\n#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test.write(\\\\s[a-z:\\\\s])?$'\n")),(0,i.kt)("p",null,"og kun lese-tilgang"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\n#context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$'\n")),(0,i.kt)("p",null,"Merk at i dette eksempelet betyr rekkef\xf8lgen noe. Planen som krever 2 scope m\xe5 v\xe6re f\xf8rst i lista over tilgjengelige planer. P\xe5 siden med oversikt over planer kan rekkef\xf8lgen endres"),(0,i.kt)("p",null,"Sjekke for flere grants"),(0,i.kt)("p",null,"Det kan v\xe6re tilfeller hvor man vil ha en plan per organisasjon. Den anbefales ikke om det er mange organisasjone som skal ha tilgang, men det er mulig og om det er et endelig lite antall er det overkommelig. For \xe5 legge inn reglel som sl\xe5r inn om det er riktig organisasjonsnumer og riktig scope:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\n#context.attributes['jwt'].claims['consumer']['ID'] == '0192:987654321' && #context.attributes['jwt'].claims['scope'] matches '^([a-z:\\\\s]\\\\s)?org:test(\\\\s[a-z:\\\\s])?$'\n")),(0,i.kt)("p",null,"N\xe5r alt er fyllt inn, trykk next."),(0,i.kt)("p",null,"For \xe5 legge inn rate-limit, kvoter, svartlisting, hvitelisting eller policy, , se ",(0,i.kt)("a",{parentName:"p",href:"/docs/datadeling/veiledere/api-manager/opprette-plan"},"veiledningen for planer")),(0,i.kt)("p",null,"Husk \xe5 publisere planen f\xf8r den kan brukes"),(0,i.kt)("h3",{id:"registrere-applikasjon"},"Registrere applikasjon"),(0,i.kt)("p",null,"For at en applikasjon skal kunne bruke APIet m\xe5 applikasjonen registreres b\xe5de i maskinporten og i Gravitee. F\xf8rst m\xe5 applikasjonen registreres som en integrasjon i maskinporten og s\xe5 m\xe5 den ",(0,i.kt)("a",{parentName:"p",href:"/docs/datadeling/veiledere/api-manager/api-manager-be-om-tilgang"},"registreres i Gravitee")," med den client","_","id som ble tildelt i maskinporten. Deretter kan applikasjonen s\xf8ke om tilgang til riktig plan og API. N\xe5r tilgang er tildelt kan APIet benyttes, man bruker ikke API-n\xf8kkel og trenger ikke hente ut denne."))}d.isMDXComponent=!0},7043:function(e,t,n){t.Z=n.p+"assets/images/image-20200928124644-1-b1764559e7b57ce2198043795e54e56c.png"},9049:function(e,t,n){t.Z=n.p+"assets/images/image-20201012173900-1-6d0358441eec3fecdf17065005012149.png"}}]);