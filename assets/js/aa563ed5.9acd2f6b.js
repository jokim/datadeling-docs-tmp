"use strict";(self.webpackChunkprod=self.webpackChunkprod||[]).push([[3721],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return g}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),k=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=k(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=k(r),g=a,u=d["".concat(s,".").concat(g)]||d[g]||m[g]||i;return r?n.createElement(u,o(o({ref:t},p),{},{components:r})):n.createElement(u,o({ref:t},p))}));function g(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var k=2;k<i;k++)o[k]=r[k];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},7534:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return k},toc:function(){return p},default:function(){return d}});var n=r(7462),a=r(3366),i=(r(7294),r(3905)),o=["components"],l={description:"Vi bruker i dag [Gravitee](https://gravitee.io) API Management som API manager og [RabbitMQ](https://rabbitmq.com) for meldingsk\xf8. Begge kj\xf8rer p\xe5 en kubernetes-distribusjon [OKD](https://okd.io) som er installert i [NREC](https://nrec.no).",pictureAlt:"Bildet kan inneholde: produkt, rektangel, skrift, parallell, skr\xe5ningen.",title:"Tekniske detaljer om IntArk-plattformen"},s="Tekniske detaljer om IntArk-plattformen",k={unversionedId:"datadeling/teknisk-plattform/teknisk",id:"datadeling/teknisk-plattform/teknisk",isDocsHomePage:!1,title:"Tekniske detaljer om IntArk-plattformen",description:"Vi bruker i dag [Gravitee](https://gravitee.io) API Management som API manager og [RabbitMQ](https://rabbitmq.com) for meldingsk\xf8. Begge kj\xf8rer p\xe5 en kubernetes-distribusjon [OKD](https://okd.io) som er installert i [NREC](https://nrec.no).",source:"@site/docs/datadeling/teknisk-plattform/teknisk.md",sourceDirName:"datadeling/teknisk-plattform",slug:"/datadeling/teknisk-plattform/teknisk",permalink:"/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/teknisk",editUrl:"https://github.com/jokim/datadelingsdokumentasjon/tree/master/docs/datadeling/teknisk-plattform/teknisk.md",version:"current",frontMatter:{description:"Vi bruker i dag [Gravitee](https://gravitee.io) API Management som API manager og [RabbitMQ](https://rabbitmq.com) for meldingsk\xf8. Begge kj\xf8rer p\xe5 en kubernetes-distribusjon [OKD](https://okd.io) som er installert i [NREC](https://nrec.no).",pictureAlt:"Bildet kan inneholde: produkt, rektangel, skrift, parallell, skr\xe5ningen.",title:"Tekniske detaljer om IntArk-plattformen"},sidebar:"tutorialSidebar",previous:{title:"RabbitMQ",permalink:"/datadeling-docs-tmp/docs/datadeling/teknisk-plattform/rabbitmq"},next:{title:"Unntaksh\xe5ndtering i IntArk",permalink:"/datadeling-docs-tmp/docs/datadeling/unntak"}},p=[{value:"Gravitee API Management",id:"gravitee-api-management",children:[]},{value:"RabbitMQ",id:"rabbitmq",children:[]},{value:"Kobling mellom API manager og meldingk\xf8",id:"kobling-mellom-api-manager-og-meldingk\xf8",children:[]},{value:"OKD",id:"okd",children:[]},{value:"Lastbalanserer",id:"lastbalanserer",children:[]},{value:"IP-ranges",id:"ip-ranges",children:[]}],m={toc:p};function d(e){var t=e.components,l=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"tekniske-detaljer-om-intark-plattformen"},"Tekniske detaljer om IntArk-plattformen"),(0,i.kt)("p",null,"Vi bruker i dag ",(0,i.kt)("a",{parentName:"p",href:"https://gravitee.io"},"Gravitee")," API Management som API manager og ",(0,i.kt)("a",{parentName:"p",href:"https://rabbitmq.com"},"RabbitMQ")," for meldingsk\xf8. Begge kj\xf8rer p\xe5 en kubernetes-distribusjon ",(0,i.kt)("a",{parentName:"p",href:"https://okd.io"},"OKD")," som er installert i ",(0,i.kt)("a",{parentName:"p",href:"https://nrec.no"},"NREC"),"."),(0,i.kt)("h2",{id:"gravitee-api-management"},"Gravitee API Management"),(0,i.kt)("p",null,"Vi bruker open source versjonen av ",(0,i.kt)("a",{parentName:"p",href:"https://gravitee.io"},"Gravitee API management.")," Vi kj\xf8rer kun komponenten som heter ",(0,i.kt)("em",{parentName:"p"},"API management"),", ikke ",(0,i.kt)("em",{parentName:"p"},"Access Management")," eller ",(0,i.kt)("em",{parentName:"p"},"Alert Engine"),"."),(0,i.kt)("p",null,"Per idag bruker vi versjon 1, og oppgraderer til siste underversjon omtrent en gang i m\xe5neden. Ved hjelp av ",(0,i.kt)("em",{parentName:"p"},"rolling upgrades")," kan vi oppgradere helt uten nedetid for ",(0,i.kt)("em",{parentName:"p"},"API gateway"),"."),(0,i.kt)("p",null,"Alle containere som brukes av Gravitee kj\xf8rer det 2 eller 3 av for \xe5 f\xe5 redundans."),(0,i.kt)("h2",{id:"rabbitmq"},"RabbitMQ"),(0,i.kt)("p",null,"RabbitMQ kj\xf8rer versjon 3.8.6, og vi benytter i hovedsak AMQPS-protokollen for \xe5 sende og motta meldinger. De fleste trenger ikke tilgang til RabbitMQ direkte, men bruker det via ",(0,i.kt)("a",{parentName:"p",href:"/docs/datadeling/teknisk-plattform/brom"},"Selvbetjeningsportalen for RabbitMQ"),"."),(0,i.kt)("p",null,"For \xe5 f\xe5 tilgang til RabbitMQ sitt management-grensesnitt kan du kontakte ",(0,i.kt)("a",{parentName:"p",href:"mailto:integrasjon@uio.no"},"integrasjon@uio.no")," for \xe5 f\xe5 opprettet en bruker og tildelt n\xf8dvendige rettigheter."),(0,i.kt)("p",null,"RabbitMQ kj\xf8rer som et cluster med 3 noder. Du m\xe5 ta h\xf8yde for at en av nodene kan v\xe6re nede, det anbefales \xe5 bruke HA-mode i produksjon."),(0,i.kt)("h2",{id:"kobling-mellom-api-manager-og-meldingk\xf8"},"Kobling mellom API manager og meldingk\xf8"),(0,i.kt)("p",null,"API manager og meldingsk\xf8 har ingen direkte kobling seg imellom. De kan derfor byttes ut uavhengig av hverandre. De snakker derimot med de samme systemene."),(0,i.kt)("h2",{id:"okd"},"OKD"),(0,i.kt)("p",null,'OKD st\xe5r for "The Community Distribution of Kubernetes that powers ',(0,i.kt)("a",{parentName:"p",href:"https://www.openshift.com"},'Red Hat OpenShift",')," og er upstream-versjonen av Openshift. Det blir i dagligtale ofte omtalt som Openshift."),(0,i.kt)("p",null,"IntArk-plattforman har egne clustre som kj\xf8rer p\xe5 NREC i osl-sonen. Per oktober 2020 brukes versjon 3.11 av OKD, men vi planlegger oppgradere til versjon 4.7 i l\xf8pet av sommeren 2021. De er installert med ovs-multitenant SDN plugin, og hvert prosjekt (namespace) er nettverksmessig isolert."),(0,i.kt)("p",null,"Hver institusjon som bruker IntArk-plattformen har hvert sitt prosjekt hvor Gravitee og RabbitMQ kj\xf8rer."),(0,i.kt)("p",null,"Oppgraderinger av OKD er for versjon 3 basert p\xe5 blue-green-metodikk. Det vil si at oppgraderinger skjer ved \xe5 installere nytt cluster med nyeste versjon av alle komponenter, og deretter flytte applikasjonene fra et cluster til et annet. Dette betyr at alle tjenester vil bytte IP-adresse ved oppgraderinger."),(0,i.kt)("h2",{id:"lastbalanserer"},"Lastbalanserer"),(0,i.kt)("p",null,"Det st\xe5r en lastbalanserer i forkant som sender trafikk til riktig cluster. Denne har samme IP-adresse for alle, og bruker ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Server_Name_Indication"},"SNI (Server Name Indication)")," for \xe5 route trafikken til riktig sted. I web-verdenen har dette v\xe6rt standard lenge og man beh\xf8ver ikke tenke p\xe5 dette. N\xe5r man skal koble til en meldingsk\xf8 m\xe5 man derimot ofte spesifisere at man skal bruke SNI."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Tekniske komponenter i IntArk-plattformen",src:r(7287).Z})),(0,i.kt)("h2",{id:"ip-ranges"},"IP-ranges"),(0,i.kt)("p",null,"IntArk sin tekniske plattform kj\xf8rer i regionen ",(0,i.kt)("em",{parentName:"p"},"osl")," til NREC. Hvis du \xf8nsker \xe5 lage brannmurregler som ikke trenger hyppige oppdateringer anbefaler vi \xe5 \xe5pne for alle subnettene til NREC. Se ",(0,i.kt)("a",{parentName:"p",href:"https://iaas.readthedocs.io/team/installation/ip.html"},"NREC sin oversikt hvilke nettverk de bruker"),"."),(0,i.kt)("p",null,"Vi anbefaler ",(0,i.kt)("strong",{parentName:"p"},"ikke")," \xe5 sperre ned til spesifikke IP-adresser, fordi:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"IntArk-installasjonene bytter cluster ved oppgraderinger"),(0,i.kt)("li",{parentName:"ol"},"Tjenester kan bytte IP-adresse"),(0,i.kt)("li",{parentName:"ol"},"Cluster utvides fortl\xf8pende med nye servere")),(0,i.kt)("p",null,"Ulempen ved \xe5 \xe5pne for alle subnettene til NREC, eller til et spesifikt cluster, er at de deles av andre institusjoner. Hvis du har API med strenge krav til brannmurregler anbefaler vi at du kj\xf8rer dette via en http-proxy-server som krever brukernavn og passord."))}d.isMDXComponent=!0},7287:function(e,t,r){t.Z=r.p+"assets/images/intark-komponenter-630785cbecd15233752216c5c4523dbd.png"}}]);